<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8"> <title>Sara Pesavento - Rdvark Blog</title> <meta http-equip="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content="Introduction to Tensorflow (pt 2/4)" /> <meta name="keywords" content="Introduction to Tensorflow (pt 2/4), Sara Pesavento, Machine_Learning" /> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml"> <meta content="" property="fb:app_id"> <meta content="Sara Pesavento" property="og:site_name"> <meta content="Introduction to Tensorflow (pt 2/4)" property="og:title"> <meta content="article" property="og:type"> <meta content="Fashion MNIST" property="og:description"> <meta content="https://spesavento.github.io//machine_learning/2020/04/02/fashion_mnist/" property="og:url"> <meta content="2020-04-02T09:05:23+00:00" property="article:published_time"> <meta content="https://spesavento.github.io//about/" property="article:author"> <meta content="Machine_Learning" property="article:section"> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@"> <meta name="twitter:creator" content="@"> <meta name="twitter:title" content="Introduction to Tensorflow (pt 2/4)"> <meta content="Sara Pesavento" property="og:site_name"> <meta name="twitter:url" content="https://spesavento.github.io//machine_learning/2020/04/02/fashion_mnist/"> <meta name="twitter:description" content="devlopr-jekyll is a Jekyll Theme Built For Developers"> <link rel="stylesheet" href="/assets/css/main.css" /> <link rel="stylesheet" href="/assets/css/custom-style.css" /> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css"/> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css"> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css"> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet"> <!-- Favicon --> <link rel="icon" href="https://spesavento.github.io//assets/img/favicon.ico" type="image/gif" sizes="16x16"> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous"></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script> <script> (function (d, h, m) { var js, fjs = d.getElementsByTagName(h)[0]; if (d.getElementById(m)) { return; } js = d.createElement(h); js.id = m; js.onload = function () { window.makerWidgetComInit({ position: "right", widget: "ofeeof264otl2l5g-zspk40eq2gaomj2n-higi2qphmveubksi" }) }; js.src = "https://makerwidget.com/js/embed.js"; fjs.parentNode.insertBefore(js, fjs) }(document, "script", "dhm")) </script> <script> (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-46783401-10', 'auto'); ga('send', 'pageview'); </script> </head><body> <div class="container-fluid"><header> <div class="col-lg-12"> <div class="row"> <nav class="navbar navbar-expand-lg fixed-top navbar-dark " id="topNav"> <!-- <a class="navbar-brand" href="#">Sara Pesavento</a> --> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <a class="navbar-brand" href="/">Sara Pesavento</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//about">About Me</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//blog">Blog</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//programming">Programming</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//gallery">Gallery</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//shop">Shop</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//contact">Contact Me</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//styleguide">Styleguide</a> </li> <li class="nav-item"> <a class="nav-link" href="https://spesavento.github.io//get-started">Get Started</a> </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link" id="search-icon" href="https://spesavento.github.io//search/"><i class="fa fa-search" aria-hidden="true"></i></a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() "type="checkbox" name="checkbox" > </li> </ul> </nav> </div> </div> </header><div class="col-lg-12"> <!-- Blog Post Breadcrumbs --><div class="col-lg-12"> <nav aria-label="breadcrumb" role="navigation"> <ol class="breadcrumb"> <li class="breadcrumb-item"> <a href="https://spesavento.github.io//blog"><i class="fa fa-home" aria-hidden="true"></i></a> </li> <li class="breadcrumb-item active" aria-current="page"><a href="/machine_learning/2020/04/02/fashion_mnist/">Introduction to Tensorflow (pt 2/4)</a></li> </ol> </nav> </div><div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <!-- <h1 class="post-title" itemprop="name headline">Introduction to Tensorflow (pt 2/4)</h1> --> <h4 class="post-meta">Fashion MNIST</h4> <p class="post-summary">Posted by : <img src="https://spesavento.github.io//assets/img/profile.png" class="author-profile-img"> <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Sara Pesavento</span> </span> at <time datetime="2020-04-02 09:05:23 +0000" itemprop="datePublished">Apr 2, 2020</time> </p> <span class="disqus-comment-count" data-disqus-identifier="/machine_learning/2020/04/02/fashion_mnist/"></span> <div class="post-categories"> Category : <a href="/blog/categories/Machine_Learning">Machine_Learning</a> </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="https://spesavento.github.io//assets/img/posts/mnist_cover.png" alt=""> <br/> <br/> <p><em>Material follows a Udacity Tensorflow course.</em></p> <p>In this lesson, I will build a model to identify pieces of clothing. The Fashion MNIST dataset contains 70,000 images of clothing, each of which are 28 x 28 pixels and belong to one of the 10 clothing groups listed below.</p> <table> <tbody> <tr> <td><img src="/assets/img/posts/mnist_samples.png" alt="" height="450px" /></td> <td><strong><u>Label</u></strong>       <strong><u>Item</u></strong> <br /> <strong><span style="color:red">0</span></strong>        <strong><span style="color:red">T-shirt/top</span></strong><br /> 1         Trouser<br /> 2        Pullover<br /> 3        Dress<br /> 4        Coat<br /> <strong><span style="color:green">5</span></strong>        <strong><span style="color:green">Sandal</span></strong> <br /> 6         Shirt<br /> 7         Sneaker<br /> 8         Bag<br /> 9         Ankle boot</td> </tr> </tbody> </table> <p><em><a href="https://en.wikipedia.org/wiki/Mean_squared_error">Fashion-MNIST</a> samples (by Zalando, MIT License).</em></p> <h3 id="training-and-testing"><strong>Training and Testing</strong></h3> <table> <tbody> <tr> <td><img src="/assets/img/posts/mnist_pie.png" alt="deploy using travis" class="img-fluid" height="950px" width="950px" /></td> <td>Most of the images will be used as training data to tune the model. However, 10,000 images will be set aside to see how the model performs on images it has never seen before. This decreases chances of overfitting the model.</td> </tr> </tbody> </table> <p>It is common to use what is called a <strong>Validation</strong> dataset. This dataset is not used for training. Instead, it it used to test the model during training. This is done after some set number of training steps, and gives us an indication of how the training is progressing. For example, if the loss is being reduced during training, but accuracy deteriorates on the validation set, that is an indication that the model is simply memorizing the training set.</p> <h3 id="model-layers"><strong>Model Layers</strong></h3> <p>Because each image is 28×28 pixels, there needs to be 784 nodes (the total area) in the input layer. This is because the 2D image is converted into a one-dimensional array. This process is called <strong>flattening</strong>. In code, this is done with a flatting layer.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span> <span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</code></pre></div></div> <p>Then there is a dense layer, which has 128 units in this example. <a href="https://www.kaggle.com/dansbecker/rectified-linear-units-relu-in-deep-learning">ReLU</a> (Rectified Linear Unit) gives the dense layer more power. ReLU is a type of activation function that allows to solve for nonlinear problems. Last time we had a y=mx+b format for the Celsius to Fahrenheit conversion, but most problems won’t be linear. There several of these functions (ReLU, Sigmoid, tanh, ELU), but ReLU is used most commonly and serves as a good default. <strong>f(x) = max(0, x)</strong></p> <p><img src="/assets/img/posts/mnist_graph.png" alt="deploy using travis" class="img-fluid" height="350px" width="350px" /></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">)</span>
</code></pre></div></div> <p>The output layer contains 10 units, because the fashion MNIST datasets contains 10 labels for clothing. Each unit specifies the probability that the inputted image of clothing belongs to that label. For example if you input an image of a t-shirt, it may be outputted as .88 t-shit (label=0), .04 trouser (label = 1), .1 pullover (label = 2), etc. This is how confident the model is that the image belongs to each clothing group. The goal is to get the percentage for t-shit as high as possible after training the model so that the image is classified correctly. The actual percentages should be 1 t-shirt (label = 0), 0 trouser (label=1), 0 pullover (label = 2), etc. <br /><br /> Here is an example of what might be outputted with an image of a shirt:</p> <p><img src="/assets/img/posts/mnist_shirt.png" alt="deploy using travis" class="img-fluid" height="650px" width="650px" /> <em>The model is 85% confident this image is of a shirt. Notice the percentages sum to 1. This is a probability distribution.</em></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">softmax</span><span class="p">)</span>
</code></pre></div></div> <p><strong>Softmax</strong>: A function that provides probabilities for each possible output class.</p> <p><img src="/assets/img/posts/mnist_neural.png" alt="deploy using travis" class="img-fluid" height="650px" width="650px" /> <em>A visual of each layer of the neural network.</em></p> <h3 id="classifying-images-of-clothing"><strong>Classifying Images of Clothing</strong></h3> <h4 id="1-install-and-import-dependencies"><strong>1. Install and import dependencies</strong></h4> <p>MNIST fashion dataset is in tensorflow_datasets so we can install these.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">U</span> <span class="n">tensorflow_datasets</span>
</code></pre></div></div> <p>Now import tensorflow and some libraries needed.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="c1"># Import TensorFlow and TensorFlow Datasets
</span><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">import</span> <span class="nn">tensorflow_datasets</span> <span class="k">as</span> <span class="n">tfds</span>
<span class="n">tf</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">logging</span><span class="p">.</span><span class="n">ERROR</span><span class="p">)</span> 
 
<span class="c1"># Helper libraries
</span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span> 
 
<span class="c1"># Improve progress bar display
</span><span class="kn">import</span> <span class="nn">tqdm</span>
<span class="kn">import</span> <span class="nn">tqdm.auto</span> <span class="n">tqdm</span><span class="p">.</span><span class="n">tqdm</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">.</span><span class="n">auto</span><span class="p">.</span><span class="n">tqdm</span> 
 
<span class="k">print</span><span class="p">(</span><span class="n">tf</span><span class="p">.</span><span class="n">__version__</span><span class="p">)</span>
 
<span class="c1"># This will go away in the future.
# If this gives an error, you might be running TensorFlow 2
# or above
# If so, the just comment out this line and run this
# cell again
</span><span class="n">tf</span><span class="p">.</span><span class="n">enable_eager_execution</span><span class="p">()</span>
</code></pre></div></div> <p>The MNIST data can be accessed via the dataset API. It then should be split into the training and testing data. Class names aren’t included so you can create a vector of them.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dataset</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">tfds</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">'fashion_mnist'</span><span class="p">,</span>
<span class="n">as_supervised</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
 
<span class="n">train_dataset</span><span class="p">,</span> <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="s">'train'</span><span class="p">],</span> <span class="n">dataset</span><span class="p">[</span><span class="s">'test'</span><span class="p">]</span>
 
<span class="n">class_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">'T-shirt/top'</span><span class="p">,</span><span class="s">'Trouser'</span><span class="p">,</span><span class="s">'Pullover'</span><span class="p">,</span><span class="s">'Dress'</span><span class="p">,</span><span class="s">'Coat'</span><span class="p">,</span>
               <span class="s">'Sandal'</span><span class="p">,</span><span class="s">'Shirt'</span><span class="p">,</span><span class="s">'Sneaker'</span><span class="p">,</span><span class="s">'Bag'</span><span class="p">,</span><span class="s">'Ankle boot'</span><span class="p">]</span>
</code></pre></div></div> <h4 id="explore-the-data"><strong>*Explore the Data</strong></h4> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_train_examples</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">.</span><span class="n">splits</span><span class="p">[</span><span class="s">'train'</span><span class="p">].</span><span class="n">num_examples</span>
<span class="n">num_test_examples</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">.</span><span class="n">splits</span><span class="p">[</span><span class="s">'test'</span><span class="p">].</span><span class="n">num_examples</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Number of training examples: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">num_train_examples</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">"Number of test examples: {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">num_test_examples</span><span class="p">))</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_explore.png" alt="deploy using travis" class="img-fluid" height="250px" width="250px" /></p> <h4 id="2-preprocess-the-data"><strong>2. Preprocess the data</strong></h4> <p>The value of each pixel in the image data is an integer in the range [0,255]. This is because the 28×28 images have pixel values ranging from 0 to 255. For the model to work properly, these values need to be normalized to the range [0,1]. So here we create a normalization function, and then apply it to each image in the test and train datasets.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
  <span class="n">images</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">cast</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">tf</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
  <span class="n">images</span> <span class="o">/=</span> <span class="mi">255</span>
  <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> 
 
<span class="c1"># The map function applies the normalize function to each
# element in the train and test datasets 
</span> 
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">normalize</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="n">normalize</span><span class="p">)</span>
</code></pre></div></div> <h4 id="explore-the-processed-data"><strong>*Explore the processed data</strong></h4> <p>Let’s take a look at an image! Notice the color scale is from 0 to 1 (instead of 0 to 255).</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Take a single image, and remove the color dimension by reshaping
</span><span class="k">for</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
  <span class="k">break</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">numpy</span><span class="p">().</span><span class="n">reshape</span><span class="p">((</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">))</span> 
 
<span class="c1"># Plot the image - voila a piece of fashion clothing
</span><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">binary</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_shirt2.png" alt="deploy using travis" class="img-fluid" height="450px" width="450px" /></p> <p>Display the first 25 images from the training set and display the class name below each image. Verify that the data is in the correct format and we’re ready to build and train the network.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span>
  <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">numpy</span><span class="p">().</span><span class="n">reshape</span><span class="p">((</span><span class="mi">28</span><span class="p">,</span><span class="mi">28</span><span class="p">))</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">binary</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">class_names</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
  <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">plt</span><span class="p">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_shirt3.png" alt="deploy using travis" class="img-fluid" height="450px" width="450px" /></p> <h4 id="3-build-the-model"><strong>3. Build the model</strong></h4> <p>To build the neural network we need to first configure the layers of the model then compile the model.</p> <h4 id="-setup-the-layers"><strong>* Setup the layers</strong></h4> <p>The basic building block of a neural network is the <em>layer</em>. Earlier we discussed the input, dense, and output layer. Much of deep learning consists of chaining together simple layers. Most layers, like <code class="highlighter-rouge">tf.keras.layers.Dense</code>, have internal parameters which are adjusted (“learned”) during training.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">relu</span><span class="p">),</span>
    <span class="n">tf</span><span class="p">.</span><span class="n">keras</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span>  <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">nn</span><span class="p">.</span><span class="n">softmax</span><span class="p">)</span>
<span class="p">])</span>
</code></pre></div></div> <p>To recap, this neural network has three following layers:</p> <ul> <li><strong>input</strong> <code class="highlighter-rouge">tf.keras.layers.Flatten</code> — This layer transforms the images from a 2d-array of 28 × 28 pixels), to a 1d-array of 784 pixels (28*28). Think of this layer as unstacking rows of pixels in the image and lining them up. This layer has no parameters to learn, as it only reformats the data.</li> <li><strong>hidden</strong> <code class="highlighter-rouge">tf.keras.layers.Dense</code>— A densely connected layer of 128 neurons. Each neuron (or node) takes input from all 784 nodes in the previous layer, weighting that input according to hidden parameters which will be learned during training, and outputs a single value to the next layer.</li> <li><strong>output</strong> <code class="highlighter-rouge">tf.keras.layers.Dense</code> — A 10-node <em>softmax</em> layer, with each node representing a class of clothing. As in the previous layer, each node takes input from the 128 nodes in the layer before it. Each node weights the input according to learned parameters, and then outputs a value in the range [0, 1], representing the probability that the image belongs to that class. The sum of all 10 node values is 1.</li> </ul> <h4 id="-compile-the-model"><strong>* Compile the model</strong></h4> <p>Before the model is ready for training, we add a few settings to the compile step:</p> <ul> <li><em>Loss function</em> — An algorithm for measuring how far the model’s outputs are from the desired output. We want to minimize the losses. The conventional way is to have the target outputs converted to the one-hot encoded array to match with the output shape, but with <code class="highlighter-rouge">sparse_categorical_crossentropy</code>, we can keep the integers as targets.</li> <li><em>Optimizer</em> —An algorithm for adjusting the inner parameters of the model in order to minimize loss.</li> </ul> <table> <tbody> <tr> <td><img src="/assets/img/posts/mnist_adam.png" alt="" class="img-fluid" height="650px" width="650px" /></td> <td>Adam is an optimization algorithm that can used instead of the classical stochastic gradient descent procedure to update network weights iterative based in training data.</td> </tr> </tbody> </table> <p><em>Adam: A Method for Stochastic Optimization, 2015.</em></p> <ul> <li><em>Metrics</em> —Used to monitor the training and testing steps. The following example uses accuracy, the fraction of the images that are correctly classified.</li> </ul> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optimizer</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="n">train</span><span class="p">.</span><span class="n">AdamOptimizer</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
<span class="n">beta1</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s">'sparse_categorical_crossentropy'</span><span class="p">,</span>
<span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span>
</code></pre></div></div> <h4 id="4-train-the-model"><strong>4. Train the model</strong></h4> <p>First, we define the iteration behavior for the train dataset:</p> <ol> <li>Repeat forever by specifying <code class="highlighter-rouge">dataset.repeat()</code> (the epochs parameter described below limits how long we perform training).</li> <li>The <code class="highlighter-rouge">dataset.shuffle(60000)</code> randomizes the order so our model cannot learn anything from the order of the examples.</li> <li>And <code class="highlighter-rouge">dataset.batch(32)</code> tells <code class="highlighter-rouge">model.fit</code> to use batches of 32 images and labels when updating the model variables.</li> </ol> <p>Training is performed by calling the <code class="highlighter-rouge">model.fit</code> method:</p> <ol> <li>Feed the training data to the model using <code class="highlighter-rouge">train_dataset</code>.</li> <li>The model learns to associate images and labels.</li> <li>The <code class="highlighter-rouge">epochs=5</code> parameter limits training to 5 full iterations of the training dataset, so a total of 5 * 60,000 = 300,000 examples.</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">.</span><span class="n">repeat</span><span class="p">().</span>
  <span class="n">shuffle</span><span class="p">(</span><span class="n">num_train_examples</span><span class="p">).</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">batch</span><span class="p">(</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
 
<span class="n">model</span><span class="p">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
  <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_train_examples</span><span class="o">/</span><span class="n">BATCH_SIZE</span><span class="p">))</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_train.png" alt="deploy using travis" class="img-fluid" height="650px" width="650px" /></p> <p>As the model trains, the loss and accuracy metrics are displayed. This model reaches an accuracy of about 89% on the training data.</p> <h4 id="5-evaluate-the-model"><strong>5. Evaluate the model</strong></h4> <p>The model classifies training images with 89% accuracy, but how does it perform on images it has never seen before? We want to make sure the model didn’t just memorize the training images.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">test_loss</span><span class="p">,</span> <span class="n">test_accuracy</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span>
  <span class="n">steps</span><span class="o">=</span><span class="n">math</span><span class="p">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_test_examples</span><span class="o">/</span><span class="mi">32</span><span class="p">))</span> 
 
<span class="k">print</span><span class="p">(</span><span class="s">'Accuracy on test dataset:'</span><span class="p">,</span> <span class="n">test_accuracy</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_accuracy.png" alt="deploy using travis" class="img-fluid" height="650px" width="650px" /></p> <p>It is less accurate with the test data, but that is expected since the model was trained on the <code class="highlighter-rouge">train_dataset</code>.</p> <h4 id="6-make-predictions-and-explore"><strong>6. Make predictions and explore</strong></h4> <p>With the model trained, we can use it to make predictions about some images.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">test_images</span><span class="p">,</span> <span class="n">test_labels</span> <span class="ow">in</span> <span class="n">test_dataset</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
  <span class="n">test_images</span> <span class="o">=</span> <span class="n">test_images</span><span class="p">.</span><span class="n">numpy</span><span class="p">()</span>
  <span class="n">test_labels</span> <span class="o">=</span> <span class="n">test_labels</span><span class="p">.</span><span class="n">numpy</span><span class="p">()</span>
  <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_images</span><span class="p">)</span>
 
<span class="n">predictions</span><span class="p">.</span><span class="n">shape</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_prediction.png" alt="deploy using travis" class="img-fluid" height="100px" width="100px" /></p> <p>32 images with 10 label (clothing group) predictions.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_prediction2.png" alt="deploy using travis" class="img-fluid" height="570px" width="570px" /></p> <p>Which is the highest? Check the test label to see if this is correct.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
 
<span class="n">test_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div> <p>Both of the outputs are 6.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions_array</span><span class="p">,</span> <span class="n">true_labels</span><span class="p">,</span> <span class="n">images</span><span class="p">):</span>
  <span class="n">predictions_array</span><span class="p">,</span> <span class="n">true_label</span><span class="p">,</span> <span class="n">img</span> <span class="o">=</span> <span class="n">predictions_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
  <span class="n">true_labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span> 
 
  <span class="n">plt</span><span class="p">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">[...,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="p">.</span><span class="n">cm</span><span class="p">.</span><span class="n">binary</span><span class="p">)</span> 
 
  <span class="n">predicted_label</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions_array</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">predicted_label</span> <span class="o">==</span> <span class="n">true_label</span><span class="p">:</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'blue'</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">color</span> <span class="o">=</span> <span class="s">'red'</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"{} {:2.0f}% ({})"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">class_names</span><span class="p">[</span><span class="n">predicted_label</span><span class="p">],</span>
                                <span class="mi">100</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nb">max</span><span class="p">(</span><span class="n">predictions_array</span><span class="p">),</span>
                                <span class="n">class_names</span><span class="p">[</span><span class="n">true_label</span><span class="p">]),</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
 
<span class="k">def</span> <span class="nf">plot_value_array</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions_array</span><span class="p">,</span> <span class="n">true_label</span><span class="p">):</span>
  <span class="n">predictions_array</span><span class="p">,</span> <span class="n">true_label</span> <span class="o">=</span> <span class="n">predictions_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">true_label</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">([])</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">yticks</span><span class="p">([])</span>
  <span class="n">thisplot</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">bar</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">predictions_array</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#777777"</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
  <span class="n">predicted_label</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions_array</span><span class="p">)</span>
  <span class="n">thisplot</span><span class="p">[</span><span class="n">predicted_label</span><span class="p">].</span><span class="n">set_color</span><span class="p">(</span><span class="s">'red'</span><span class="p">)</span>
  <span class="n">thisplot</span><span class="p">[</span><span class="n">true_label</span><span class="p">].</span><span class="n">set_color</span><span class="p">(</span><span class="s">'blue'</span><span class="p">)</span>
</code></pre></div></div> <p>Let’s look at the 0th image, predictions, and prediction array. Correct prediction labels are blue and incorrect prediction labels are red.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">test_images</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot_value_array</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span>  <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_shirttest.png" alt="deploy using travis" class="img-fluid" height="470px" width="470px" /></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">i</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">test_images</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plot_value_array</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span>  <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_shirttest2.png" alt="deploy using travis" class="img-fluid" height="470px" width="470px" /></p> <p>Let’s plot several images with their predictions. Note that even when the model is very confident, it is not necessarily correct.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Plot the first X test images, their predicted label,
# and the true label
# Color correct predictions in blue, incorrect predictions in red
</span><span class="n">num_rows</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">num_cols</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">num_images</span> <span class="o">=</span> <span class="n">num_rows</span><span class="o">*</span><span class="n">num_cols</span>
<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_rows</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_images</span><span class="p">):</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">plot_image</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">,</span> <span class="n">test_images</span><span class="p">)</span>
  <span class="n">plt</span><span class="p">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">num_cols</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">plot_value_array</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_predictiontest.png" alt="deploy using travis" class="img-fluid" height="570px" width="570px" /></p> <p>Finally, use the trained model to make a prediction about a single image.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Grab an image from the test dataset
</span><span class="n">img</span> <span class="o">=</span> <span class="n">test_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_predictiontest2.png" alt="deploy using travis" class="img-fluid" height="120px" width="120px" /></p> <p><code class="highlighter-rouge">tf.keras</code> models are optimized to make predictions on a <strong>batch</strong>, or collection, of examples at once. So even though we’re using a single image, we need to add it to a list:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Add the image to a batch where it's the only member.
</span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([</span><span class="n">img</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_predictiontest3.png" alt="deploy using travis" class="img-fluid" height="170px" width="170px" /></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">predictions_single</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="n">predict</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">predictions_single</span><span class="p">)</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_predictiontest4.png" alt="deploy using travis" class="img-fluid" height="570px" width="570px" /></p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_value_array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">predictions_single</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">class_names</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
 
<span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">predictions_single</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></div> <p><img src="/assets/img/posts/mnist_pred.png" alt="deploy using travis" class="img-fluid" height="470px" width="470px" /></p> <p>The model predicted 6, a shirt.</p> <h4 id="7-exercises"><strong>7. Exercises</strong></h4> <ul> <li> <p>Set training epochs set to 1 With 1 epoch instead of 5 the accuracy lowers from 89% to 82.6%. This is because the epochs parameter limits how long we perform training.</p> </li> <li> <p>Number of neurons in the Dense layer following the Flatten one. For example, go really low (e.g. 10) in ranges up to 512 and see how accuracy changes</p> </li> </ul> <p>With 10 neurons in the Dense layer, the accuracy decreases from 89% to 85.5%.</p> <p><img src="/assets/img/posts/mnist_exercise1.png" alt="deploy using travis" class="img-fluid" height="670px" width="670px" /></p> <p>With 512 neurons in the Dense layer, the accuracy increased from 89.24% to 89.78%</p> <p><img src="/assets/img/posts/mnist_exercise2.png" alt="deploy using travis" class="img-fluid" height="670px" width="670px" /></p> <ul> <li>Add additional Dense layers between the Flatten and the final Dense(10, activation=tf.nn.softmax), experiment with different units in these layers. The original test accuracy was 87.4%. Adding an additional Dense layer with 158 nodes increased the test data accuracy to 88.1%. Adding a Dense layer with 10 nodes slightly decreased the test accuracy to 87.3%. Adding a Dense layer with 512 nodes increased the training accuracy to 89.7% but slightly decreased the test accuracy to 87.3%. This could be a sign of overfitting.</li> </ul> </div> <div id="disqus_thread"></div> </article> <script> var disqus_config = function () { this.page.url = "https://spesavento.github.io//machine_learning/2020/04/02/fashion_mnist/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/machine_learning/2020/04/02/fashion_mnist"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://sujay-kundu.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <!-- End of row--> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header"> About </div> <div class="card-body"> <!-- Your Bio --> <p class="author_bio"> Data Scientist with B.S. Statistics (3.8 GPA, Cum Laude) from UCLA. Programming knowledge includes R, Python, SQL, Tableau, SAS and other data analysis tools.</p><!-- Place this tag where you want the button to render. --> <a class="github-button" href="https://github.com/sujaykundu777/devlopr-jekyll" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a></div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories </div> <div class="card-body text-dark"> <div id="#guides"></div> <li class="tag-head"> <a href="/blog/categories/guides">guides</a> </li> <a name="guides"></a> <div id="#Machine_Learning"></div> <li class="tag-head"> <a href="/blog/categories/Machine_Learning">Machine_Learning</a> </li> <a name="Machine_Learning"></a> <div id="#30_Days_of_Code"></div> <li class="tag-head"> <a href="/blog/categories/30_Days_of_Code">30_Days_of_Code</a> </li> <a name="30_Days_of_Code"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links </div> <div class="card-body text-dark"> <li > <a href="https://spesavento.github.io//about">About Me</a> </li> <li > <a href="https://spesavento.github.io//blog">Blog</a> </li> <li > <a href="https://spesavento.github.io//programming">Programming</a> </li> <li > <a href="https://spesavento.github.io//gallery">Gallery</a> </li> <li > <a href="https://spesavento.github.io//shop">Shop</a> </li> <li > <a href="https://spesavento.github.io//contact">Contact Me</a> </li> <li > <a href="https://spesavento.github.io//styleguide">Styleguide</a> </li> <li > <a href="https://spesavento.github.io//get-started">Get Started</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"><!-- Mailchimp Newletters --> <form action="https://sujaykundu.us10.list-manage.com/subscribe/post?u=50bab1c85eae24ecfb0f68361&amp;id=3a2dd721d0"method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate> <div id="mc_embed_signup_scroll_footer"> <label for="mce-EMAIL_footer"> Signup for Weekly Email Newsletters :D</label> <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL_footer" placeholder="email address" required> <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups--> <div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_50bab1c85eae24ecfb0f68361_3a2dd721d0" tabindex="-1" value=""> </div><br /> <div class="clear"> <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe_footer" class="btn btn-lg btn-success"> </div> </div> </div> </div> <footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>. Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> </div> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="/assets/js/mode-switcher.js"></script> </body> </html>
